<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reset Password ‚Äì Hawk Central</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --gold: #F5C518; --gold-dark: #D4A900; --black: #111111; --white: #FFFFFF; --gray-bg: #F3F3F3; --gray-light: #E8E8E8; --gray-text: #666666; }
    body { font-family: 'DM Sans', sans-serif; background: var(--gray-bg); color: var(--black); min-height: 100vh; }
    nav { background: var(--black); display: flex; align-items: center; padding: 0 32px; height: 70px; }
    .nav-brand { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .nav-logo { width: 44px; height: 44px; background: var(--gold); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--black); }
    .nav-title span:first-child { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--gold); letter-spacing: 1px; line-height: 1; display: block; }
    .nav-title span:last-child { font-size: 11px; color: #888; display: block; }
    .page { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 70px); padding: 32px 20px; }
    .card { background: var(--white); border-radius: 20px; padding: 40px; width: 100%; max-width: 440px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); }
    .card-icon { width: 64px; height: 64px; background: var(--gold); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 20px; }
    .card h1 { font-family: 'Bebas Neue', sans-serif; font-size: 32px; letter-spacing: 1px; text-align: center; margin-bottom: 8px; }
    .subtitle { color: var(--gray-text); font-size: 14px; text-align: center; margin-bottom: 28px; line-height: 1.5; }
    .step { display: none; }
    .step.active { display: block; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 5px; }
    .form-group input { width: 100%; padding: 12px 14px; border: 2px solid var(--gray-light); border-radius: 10px; font-size: 14px; font-family: 'DM Sans', sans-serif; outline: none; transition: border-color 0.2s; color: var(--black); background: var(--white); }
    .form-group input:focus { border-color: var(--gold); }
    .btn-submit { width: 100%; padding: 13px; background: var(--gold); border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: background 0.2s; margin-top: 4px; }
    .btn-submit:hover { background: var(--gold-dark); }
    .btn-submit:disabled { background: #ccc; cursor: not-allowed; }
    .back-link { display: block; text-align: center; margin-top: 16px; font-size: 13px; color: var(--gray-text); text-decoration: none; }
    .back-link:hover { color: var(--black); }
    .success-box { background: #e8f5e9; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 20px; }
    .success-box .icon { font-size: 36px; margin-bottom: 8px; }
    .success-box p { font-size: 14px; color: #2e7d32; line-height: 1.5; }
    .info-box { background: #fff8e1; border: 2px solid var(--gold); border-radius: 10px; padding: 14px; margin-bottom: 20px; font-size: 13px; color: #555; line-height: 1.5; }
    .toast { position: fixed; bottom: 24px; right: 24px; background: var(--black); color: var(--white); padding: 14px 20px; border-radius: 12px; font-size: 14px; font-weight: 600; display: none; z-index: 300; max-width: 320px; }
    .toast.show { display: block; }
  </style>
</head>
<body>

<nav>
  <a class="nav-brand" href="index.html">
    <div class="nav-logo">H</div>
    <div class="nav-title"><span>HAWK CENTRAL</span><span>Campus Events</span></div>
  </a>
</nav>

<div class="page">
  <div class="card">
    <div class="card-icon">üîë</div>

    <!-- STEP 1: Enter email -->
    <div class="step active" id="step1">
      <h1>Forgot Password</h1>
      <p class="subtitle">Enter your Hawk Central email and we'll send you a reset link.</p>
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="resetEmail" placeholder="you@hawk.edu"/>
      </div>
      <button class="btn-submit" id="sendBtn" onclick="requestReset()">Send Reset Link</button>
      <a href="index.html" class="back-link">‚Üê Back to Home</a>
    </div>

    <!-- STEP 2: Reset password (token from URL) -->
    <div class="step" id="step2">
      <h1>New Password</h1>
      <p class="subtitle">Choose a new password for your Hawk Central account.</p>
      <div class="info-box">‚úÖ Reset link verified! Enter your new password below.</div>
      <input type="hidden" id="resetToken"/>
      <div class="form-group">
        <label>New Password</label>
        <input type="password" id="newPassword" placeholder="At least 6 characters"/>
      </div>
      <div class="form-group">
        <label>Confirm New Password</label>
        <input type="password" id="confirmPassword" placeholder="Repeat your new password"/>
      </div>
      <button class="btn-submit" onclick="submitReset()">Reset Password</button>
      <a href="index.html" class="back-link">‚Üê Back to Home</a>
    </div>

    <!-- STEP 3: Success -->
    <div class="step" id="step3">
      <h1>All Done!</h1>
      <div class="success-box">
        <div class="icon">‚úÖ</div>
        <p>Your password has been successfully reset. You can now log in with your new password.</p>
      </div>
      <button class="btn-submit" onclick="window.location.href='index.html'">Go to Login</button>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  var API = 'http://localhost:3000';

  // Read token from URL
  function getTokenFromURL() {
    var href = window.location.href;
    var tokenIndex = href.indexOf('token=');
    if (tokenIndex === -1) return null;
    var token = href.substring(tokenIndex + 6);
    var ampIndex = token.indexOf('&');
    if (ampIndex !== -1) token = token.substring(0, ampIndex);
    return token.length > 10 ? token : null;
  }

  // Auto-jump to step 2 if token is in URL
  var urlToken = getTokenFromURL();
  if (urlToken) {
    document.getElementById('step1').className = 'step';
    document.getElementById('step2').className = 'step active';
    document.getElementById('resetToken').value = urlToken;
  }

  function requestReset() {
    var email = document.getElementById('resetEmail').value.trim();
    if (!email) { showToast('‚ö†Ô∏è Please enter your email'); return; }

    var btn = document.getElementById('sendBtn');
    btn.disabled = true;
    btn.textContent = 'Sending...';

    fetch(API + '/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: email })
    })
    .then(function(res) {
      if (!res.ok) return res.text().then(function(err) { throw new Error(err); });
      return res.json();
    })
    .then(function() {
      document.getElementById('step1').innerHTML =
        '<div style="text-align:center; padding:20px 0;">' +
        '<div style="font-size:48px; margin-bottom:16px;">üì¨</div>' +
        '<h1 style="font-family:Bebas Neue,sans-serif; font-size:28px; margin-bottom:8px;">Check Your Email</h1>' +
        '<p style="color:#666; line-height:1.6; margin-bottom:24px;">We sent a reset link to <strong>' + email + '</strong>.<br/>Check your inbox and click the link.<br/><em style="font-size:12px;">The link expires in 1 hour.</em></p>' +
        '<a href="index.html" style="color:#D4A900; font-weight:600; text-decoration:none;">‚Üê Back to Home</a>' +
        '</div>';
    })
    .catch(function(err) {
      showToast('‚ùå ' + err.message);
      btn.disabled = false;
      btn.textContent = 'Send Reset Link';
    });
  }

  function submitReset() {
    var token = document.getElementById('resetToken').value;
    var newPassword = document.getElementById('newPassword').value;
    var confirmPassword = document.getElementById('confirmPassword').value;

    if (!token) { showToast('‚ö†Ô∏è Reset token is missing'); return; }
    if (!newPassword) { showToast('‚ö†Ô∏è Please enter a new password'); return; }
    if (newPassword.length < 6) { showToast('‚ö†Ô∏è Password must be at least 6 characters'); return; }
    if (newPassword !== confirmPassword) { showToast('‚ö†Ô∏è Passwords do not match'); return; }

    fetch(API + '/reset-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token: token, new_password: newPassword })
    })
    .then(function(res) {
      if (!res.ok) return res.text().then(function(err) { throw new Error(err); });
      return res.json();
    })
    .then(function() {
      document.getElementById('step2').className = 'step';
      document.getElementById('step3').className = 'step active';
    })
    .catch(function(err) {
      showToast('‚ùå ' + err.message);
    });
  }

  function showToast(msg) {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show';
    setTimeout(function() { t.className = 'toast'; }, 4000);
  }
</script>
</body>
</html>